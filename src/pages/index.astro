---
import Layout from "../layouts/Layout.astro";
import teams from "../data/teams.json";
import "../styles/global.css";

const sortedTeams = [...teams].sort((a, b) => a.name.localeCompare(b.name));
const siteTitle = "homegame.today";
const pageTitle = "Is there a home game today?";
const description = "Pick your MLB team to see if there’s a home game today.";
const site = Astro.site;
const ogImage = site ? new URL(`/og/site.png`, site).toString() : `/og/site.png`;
---

<Layout title={`${pageTitle} | ${siteTitle}`} description={description} ogImage={ogImage}>
  <header class="grid gap-3 justify-items-center text-center pt-12 px-6 pb-5">
    <h1 class="m-0 font-extrabold tracking-tight text-[clamp(2rem,6vw,3rem)]">homegame.today</h1>
    <p class="m-0 opacity-80 text-[clamp(1rem,2.5vw,1.125rem)]">
      Select your team to see if there’s a home game today.
    </p>
    <label class="block w-full">
      <span class="sr-only">Search teams</span>
      <input
        id="team-search"
        type="search"
        placeholder="Search teams…"
        autocomplete="off"
        inputmode="search"
        class="w-full max-w-md mt-2 px-4 py-3 rounded-xl border border-gray-200 bg-white text-base outline-none shadow-inner focus:border-slate-300 focus:ring-2 focus:ring-blue-500/15"
      />
    </label>
  </header>

  <ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-4 px-6 pb-8 list-none m-0" id="team-grid">
    {
      sortedTeams.map((team) => (
        <li class="list-none" data-team={team.name.toLowerCase()}>
          <a
            aria-label={`Go to ${team.name} page`}
            class="flex items-center gap-3 px-4 py-3.5 no-underline bg-white border border-gray-200 rounded-xl duration-150 ease-out hover:-translate-y-px hover:bg-gray-50 hover:border-gray-300"
            href={`https://${team.slug}.homegame.today`}
          >
            <span
              class="w-3 h-3 rounded-full shadow-[inset_0_0_0_1px_rgba(0,0,0,0.08)]"
              style={`background:${team.colors?.[0] ?? "#e5e7eb"}`}
            />
            <span class="font-semibold tracking-tight">{team.name}</span>
          </a>
        </li>
      ))
    }
  </ul>
  <p id="no-results" class="text-center px-6 pb-12 opacity-80">No teams match your search.</p>
  <script>
    const searchInput = document.getElementById("team-search") as HTMLInputElement | null;
    const grid = document.getElementById("team-grid") as HTMLElement | null;
    const items = Array.from(grid?.querySelectorAll("[data-team]") ?? []) as HTMLElement[];
    const emptyState = document.getElementById("no-results") as HTMLElement | null;

    function normalize(text: string): string {
      return (text || "").toLowerCase();
    }

    function applyFilter(q: string): void {
      const query = normalize(q);
      let visible = 0;
      for (const item of items) {
        const name = item.dataset.team || "";
        const show = name.includes(query);
        item.hidden = !show;
        if (show) visible++;
      }
      if (emptyState) emptyState.hidden = visible !== 0;
    }

    if (searchInput) {
      searchInput.addEventListener("input", () => applyFilter(searchInput.value || ""));
    }
    document.addEventListener("DOMContentLoaded", () => applyFilter(""));
  </script>
</Layout>
